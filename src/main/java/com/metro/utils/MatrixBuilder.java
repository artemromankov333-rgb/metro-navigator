package com.metro.utils;

import java.io.BufferedWriter;
import java.io.FileOutputStream;
import java.io.IOException;
import java.io.OutputStreamWriter;
import java.nio.charset.StandardCharsets;
import java.util.Arrays;
import java.util.LinkedHashMap;
import java.util.Map;

public final class MatrixBuilder {

    private static final int INF = 9;

    private MatrixBuilder() {
        throw new AssertionError("Utility class cannot be instantiated");
    }

    public static void main(String[] args) {
        try {
            generateMetroMatrix("metro.txt");
            System.out.println("Matrix successfully generated and saved to metro.txt");
        } catch (IOException e) {
            System.err.println("Error generating matrix: " + e.getMessage());
            e.printStackTrace();
            System.exit(1);
        }
    }

    public static void generateMetroMatrix(String outputFileName) throws IOException {
        Map<String, Integer> index = new LinkedHashMap<>();
        for (int i = 0; i < STATIONS.length; i++) {
            index.put(STATIONS[i], i);
        }

        int n = STATIONS.length;
        int[][] matrix = new int[n][n];

        // Initialize matrix with INF values (9)
        for (int i = 0; i < n; i++) {
            Arrays.fill(matrix[i], INF);
            matrix[i][i] = 0; // Diagonal is 0
        }

        // Fill matrix with edge weights
        for (String[] edge : EDGES) {
            String stationA = edge[0];
            String stationB = edge[1];
            int weight = Integer.parseInt(edge[2]);

            if (!index.containsKey(stationA) || !index.containsKey(stationB)) {
                System.err.println("Warning: Unknown station in edge definition: " +
                        stationA + " or " + stationB);
                continue;
            }

            int idxA = index.get(stationA);
            int idxB = index.get(stationB);
            matrix[idxA][idxB] = weight;
            matrix[idxB][idxA] = weight; // Undirected graph
        }

        // Write matrix to file with UTF-8 encoding
        try (BufferedWriter writer = new BufferedWriter(
                new OutputStreamWriter(new FileOutputStream(outputFileName), StandardCharsets.UTF_8))) {

            // Write header
            writer.write(",");
            for (int i = 0; i < n; i++) {
                writer.write(STATIONS[i]);
                if (i < n - 1) writer.write(",");
            }
            writer.newLine();

            // Write matrix rows
            for (int i = 0; i < n; i++) {
                writer.write(STATIONS[i] + ",");
                for (int j = 0; j < n; j++) {
                    writer.write(String.valueOf(matrix[i][j]));
                    if (j < n - 1) writer.write(",");
                }
                writer.newLine();
            }
        }
    }

    // Station names remain in Russian as they are identifiers
    private static final String[] STATIONS = {
            "Девяткино", "Гражданский Проспект", "Академическая", "Политехническая",
            "Площадь Мужества", "Лесная", "Выборгская", "Площадь Ленина",
            "Чернышевская", "Площадь Восстания", "Владимирская", "Пушкинская",
            "Технологический институт-1", "Балтийская", "Нарвская", "Кировский завод",
            "Автово", "Ленинский проспект", "Проспект Ветеранов", "Парнас",
            "Проспект Просвещения", "Озерки", "Удельная", "Пионерская",
            "Чёрная речка", "Петроградская", "Горьковская", "Невский проспект",
            "Сенная площадь", "Технологический институт-2", "Фрунзенская",
            "Московские ворота", "Электросила", "Парк Победы", "Московская",
            "Звёздная", "Купчино", "Беговая", "Зенит", "Приморская",
            "Василеостровская", "Гостиный двор", "Маяковская",
            "Площадь Александра Невского-1", "Елизаровская", "Ломоносовская",
            "Пролетарская", "Обухово", "Рыбацкое", "Горный институт", "Спасская",
            "Достоевская", "Лиговский проспект", "Площадь Александра Невского-2",
            "Новочеркасская", "Ладожская", "Проспект Большевиков", "Улица Дыбенко",
            "Комендантский проспект", "Старая Деревня", "Крестовский остров",
            "Чкаловская", "Спортивная", "Адмиралтейская", "Садовая",
            "Звенигородская", "Обводный канал", "Волковская", "Бухарестская",
            "Международная", "Проспект Славы", "Дунайская", "Шушары"
    };

    private static final String[][] EDGES = {
            {"Девяткино", "Гражданский Проспект", "3"},
            {"Гражданский Проспект", "Академическая", "4"},
            {"Академическая", "Политехническая", "4"},
            {"Политехническая", "Площадь Мужества", "3"},
            {"Площадь Мужества", "Лесная", "3"},
            {"Лесная", "Выборгская", "3"},
            {"Выборгская", "Площадь Ленина", "3"},
            {"Площадь Ленина", "Чернышевская", "3"},
            {"Чернышевская", "Площадь Восстания", "3"},
            {"Площадь Восстания", "Маяковская", "3"},
            {"Площадь Восстания", "Владимирская", "2"},
            {"Владимирская", "Достоевская", "3"},
            {"Владимирская", "Пушкинская", "2"},
            {"Пушкинская", "Звенигородская", "3"},
            {"Пушкинская", "Технологический институт-1", "2"},
            {"Технологический институт-1", "Технологический институт-2", "2"},
            {"Технологический институт-1", "Балтийская", "2"},
            {"Балтийская", "Нарвская", "3"},
            {"Нарвская", "Кировский завод", "4"},
            {"Кировский завод", "Автово", "2"},
            {"Автово", "Ленинский проспект", "3"},
            {"Ленинский проспект", "Проспект Ветеранов", "2"},
            {"Парнас", "Проспект Просвещения", "3"},
            {"Проспект Просвещения", "Озерки", "2"},
            {"Озерки", "Удельная", "3"},
            {"Удельная", "Пионерская", "3"},
            {"Пионерская", "Чёрная речка", "3"},
            {"Чёрная речка", "Петроградская", "4"},
            {"Петроградская", "Горьковская", "2"},
            {"Горьковская", "Невский проспект", "4"},
            {"Невский проспект", "Гостиный двор", "4"},
            {"Невский проспект", "Сенная площадь", "2"},
            {"Сенная площадь", "Спасская", "4"},
            {"Сенная площадь", "Садовая", "4"},
            {"Сенная площадь", "Технологический институт-2", "2"},
            {"Технологический институт-2", "Фрунзенская", "3"},
            {"Фрунзенская", "Московские ворота", "3"},
            {"Московские ворота", "Электросила", "2"},
            {"Электросила", "Парк Победы", "3"},
            {"Парк Победы", "Московская", "3"},
            {"Московская", "Звёздная", "5"},
            {"Звёздная", "Купчино", "3"},
            {"Беговая", "Зенит", "4"},
            {"Зенит", "Приморская", "4"},
            {"Приморская", "Василеостровская", "4"},
            {"Василеостровская", "Гостиный двор", "4"},
            {"Гостиный двор", "Маяковская", "3"},
            {"Маяковская", "Площадь Александра Невского-1", "3"},
            {"Площадь Александра Невского-1", "Площадь Александра Невского-2", "3"},
            {"Площадь Александра Невского-1", "Елизаровская", "5"},
            {"Елизаровская", "Ломоносовская", "3"},
            {"Ломоносовская", "Пролетарская", "3"},
            {"Пролетарская", "Обухово", "3"},
            {"Обухово", "Рыбацкое", "5"},
            {"Горный институт", "Спасская", "6"},
            {"Спасская", "Садовая", "3"},
            {"Спасская", "Достоевская", "4"},
            {"Достоевская", "Лиговский проспект", "2"},
            {"Лиговский проспект", "Площадь Александра Невского-2", "2"},
            {"Площадь Александра Невского-2", "Новочеркасская", "3"},
            {"Новочеркасская", "Ладожская", "3"},
            {"Ладожская", "Проспект Большевиков", "3"},
            {"Проспект Большевиков", "Улица Дыбенко", "3"},
            {"Комендантский проспект", "Старая Деревня", "4"},
            {"Старая Деревня", "Крестовский остров", "3"},
            {"Крестовский остров", "Чкаловская", "3"},
            {"Чкаловская", "Спортивная", "2"},
            {"Спортивная", "Адмиралтейская", "3"},
            {"Адмиралтейская", "Садовая", "2"},
            {"Садовая", "Звенигородская", "3"},
            {"Звенигородская", "Обводный канал", "3"},
            {"Обводный канал", "Волковская", "3"},
            {"Волковская", "Бухарестская", "3"},
            {"Бухарестская", "Международная", "3"},
            {"Международная", "Проспект Славы", "2"},
            {"Проспект Славы", "Дунайская", "3"},
            {"Дунайская", "Шушары", "3"}
    };
}